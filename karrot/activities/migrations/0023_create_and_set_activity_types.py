# Generated by Django 3.0.9 on 2020-08-16 20:47

from django.db import migrations


def set_initial_activity_type(apps, schema_editor):
    Group = apps.get_model('groups', 'Group')
    ActivityType = apps.get_model('activities', 'ActivityType')
    Activity = apps.get_model('activities', 'Activity')
    ActivitySeries = apps.get_model('activities', 'ActivitySeries')

    for group in Group.objects.all():

        # "task" type for all groups
        set_to_activity_type, _ = ActivityType.objects.get_or_create(
            group=group,
            name='task',  # TODO: should be translated... according to some logic... or manual? TBC
            defaults={
                'colour': 2,
                'icon': 'fa-flag',
                'feedback_icon': 'fa-reply',
                'has_feedback': True,
                'has_feedback_weight': False,
            },
        )

        if group.theme == 'foodsaving':
            # "pickup" type only for foodsaving groups
            set_to_activity_type, _ = ActivityType.objects.get_or_create(
                group=group,
                name='pickup',  # TODO: should be translated... according to some logic... or manual? TBC
                defaults={
                    'colour': 1,
                    'icon': 'fa-shopping-basket',
                    'feedback_icon': 'fa-balance-scale',
                    'has_feedback': True,
                    'has_feedback_weight': True,
                },
            )

        Activity.objects.filter(place__group=group).update(typus=set_to_activity_type.id)
        ActivitySeries.objects.filter(place__group=group).update(typus=set_to_activity_type.id)


class Migration(migrations.Migration):
    dependencies = [
        ('activities', '0022_add_activity_types'),
    ]

    operations = [
        migrations.RunPython(set_initial_activity_type, reverse_code=migrations.RunPython.noop, elidable=True),
    ]
